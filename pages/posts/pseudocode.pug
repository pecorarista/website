extends ../../templates/article

block variables
  - var posted = '2015-08-24'
  - var title = 'LaTeXで擬似コード'
  - var modified = '2019-03-21'

block body
    p
      | アルゴリズムやプログラミングに関する文書を書いているとき、擬似コードを書くことがあると思います。この記事ではLaTeXで擬似コードを書く方法と見た目を変更する方法をいくつか説明したいと思います。環境としてはLuaTeXを想定していますが、それ以外の場合でも若干の変更で動くと思います。
    section#usage
      h2 1. 主な使い方
      p
        | まずは
        |
        code algpseudocode
        |
        | というパッケージを読み込みます。
        span-punct 以下のように挿入ソートのアルゴリズムを書いてみます。
        pre
          code.language-latex.
            \begin{algorithmic}[1]
                \Procedure{Insertion-Sort}{$A$}
                    \For{$j = 2 \, \ldots \, A.\mathrm{length}$}
                    \State{$k = A[j]$}
                        \State{$i = j - 1$}
                        \While{$i > 0$ and $A[i] > k$}
                            \State{$A[i + 1] = A[i]$}
                            \State{$i = i - 1$}
                        \EndWhile
                        \State{$A[i + 1] = k$}
                    \EndFor
                \EndProcedure
            \end{algorithmic}
        span-punct 表示されるのは以下のような擬似コードになります。
        .pseudocode
          img.img-responsive(src='/static/images/insertion-sort.svg')
      p
        | 普段Pythonなど
        |
        code end
        |
        | を明示しない言語に慣れていると少し冗長に感じるかもしれません。
        span-punct そのような記号を明示したくない場合はパッケージ読込時に
        pre
          code.language-latex.
            \usepackage[noend]{algpseudocode}
        | のように書いておくと
        .pseudocode
          img.img-responsive(src='/static/images/insertion-sort-no-end.svg')
        | のようなPython風の擬似コードになります。さらに
        |
        code do
        |
        | の記述も不要ならば、
        code-punct ヘッダ部分に以下のように記述します。
        pre
          code.language-latex.
            \algrenewcommand\algorithmicdo{}
      p
        | いま
        |
        code for
        |
        | の始点と終点の間には
        |
        code …
        |
        | を使っていますが、もし変えたければ
        |
        code algpseudocode.sty
        |
        | にならい新しい制御構造
        |
        code \ForTo
        |
        | をプリアンブルで定義します。
        pre
          code.language-latex.
            \algnewcommand\algorithmicto{\textbf{to}}
            \algdef{SE}[FOR]{ForTo}{EndFor}[2]{%
              \algorithmicfor\ #1\ \algorithmicto\ #2\ \algorithmicdo
            }{%
              \algorithmicend\ \algorithmicfor
            }
            % 省略
            \begin{algorithmic}[1]
                \Procedure{Insertion-Sort}{$A$}
                \ForTo{$j = 2$}{$A.\mathrm{length}$}
                    \State{$k = A[j]$}
                        \State{$i = j - 1$}
                        \While{$i > 0$ and $A[i] > k$}
                            \State{$A[i + 1] = A[i]$}
                            \State{$i = i - 1$}
                        \EndWhile
                        \State{$A[i + 1] = k$}
                    \EndFor
                \EndProcedure
            \end{algorithmic}
      p
        | アルゴリズム中
        |
        code \For
        |
        | を新しく定義した
        |
        code \ForTo
        |
        | に置き換えて次のような出力を得ます。
        .pseudocode
          img.img-responsive(src='/static/images/insertion-sort-for-to.svg')

      p
        | 新しく定義した制御構造については
        |
        code [noend]
        |
        |  オプションが適用されないのため、要らなければ
        |
        code algtext*{EndFor}
        |
        | を
        |
        code \ForTo
        |
        |  の定義の次の行にでも書いておきましょう。
    section
      h3 2. よく変更を加える項目について
      p
        | 行間は
        |
        code \setlength{\baselineskip}{Npt}
        | （
        code N
        |
        | は自然数
        | ）で変更できます。ここでは新たに
        |
        code broadalgo
        |
        | という環境を定義することにします。
        pre
          code.language-latex.
            \newenvironment{broadalgo}{%
              \setlength{\baselineskip}{17pt}
              \begin{algorithmic}[1]
            }{%
              \end{algorithmic}
            }
      p フォントはヘッダ部で以下のように書くと変更できます。
        pre
          code.language-latex.
            \usepackage{fontspec}  % 日本語を使う場合は \usepackage{luatexja-fontspec}
            \newfontfamily\algfont{DejaVu Sans Mono}
            \makeatletter
            \renewcommand{\ALG@beginalgorithmic}{\algfont}
            \makeatother
      p
        | この例では出てきませんが
        |
        code \Return
        |
        | には行番号が振られないようになっています。あったほうがよいならば再定義する必要があります。
        pre
          code.language-latex.
            \let\oldReturn\Return
            \renewcommand{\Return}{\State\oldReturn}
      p 上記の設定を使った文書の例です。
        pre
          code.language-latex
            include ../../latex/final.tex
        .pseudocode
          img.img-responsive(src='/static/images/final.svg')
