<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@pecorarista">
    <meta name="twitter:title" content="主成分分析(Principal Component Analysis, PCA) — pecorarista.com">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="https://pecorarista.com/static/images/avatar.png">
    <link rel="icon" href="/favicon.ico">
		<script>
			(function(d) {
				var config = {
					kitId: 'mbi1yhb',
					scriptTimeout: 3000,
					async: true
				},
				h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
			})(document);
		</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Amiri&family=Judson&family=Noto+Sans+JP:wght@400;700&family=Noto+Serif+JP:wght@400;700&family=Roboto+Mono:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/cosmo/bootstrap.min.css" integrity="sha384-5QFXyVb+lrCzdN228VS3HmzpiE7ZVwLQtkt+0d9W43LQMzz4HBnnqvVxKg6O+04d" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-lucario.min.css" integrity="sha512-Aj5jCt/M5XlTn+Y93TazO+EjpRTiUGMrMuaJOcBcu80Fopd7+LSL094m3pbVTNJxf1hOAMSYI/hONBGjvPWwGQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="/static/css/main.css"/>

    <title>主成分分析(Principal Component Analysis, PCA)</title>
  </head>
  <body>
    <div class="wrapper">
      <header>
        <nav class="navbar navbar-expand-lg navbar-dark">
  <div class="container">
    <div class="navbar-header pull-left"><a class="navbar-brand" href="/">pecorarista.com</a></div>
    <div class="navbar-header pull-right">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link active" href="/resources">Resources</a></li>
      </ul>
    </div>
  </div>
</nav>

      </header>
      <main>
        
<article>
  <div class="container">
    <h1>主成分分析(Principal Component Analysis, PCA)</h1>
    <div class="info text-muted">
      Posted: 2023-11-21
      
    </div>
    
<section>
<p>実験により
\(p\)
次元の観測値
\(v^{(1)},\,\ldots,\,v^{(n)}\)
を得たとする．ここで
\(n\)
と
\(p\)
はともに正整数であり，各成分は実数とする．各ベクトル\(v^{(1)},\, \ldots,\, v^{(n)}\)を1次元空間上に写し，それらの違い（分散）ができる限り強調されるようにしたい．
</p>
<p>任意の線形変換\(\varphi\colon \symbb{R}^p \to \symbb{R}\)について、<strong>Rieszの表現定理</strong>（<a href="#functional-analysis">宮島[1]</a>定理4.38）より\(w \in \symbb{R}^{1 \times p}\)が存在して\(\varphi(v) = w^\mathsf{T} v\)と表すことができる．
変換後のベクトルを\(u_1 := w^\mathsf{T} v_1,\,\ldots,\,u_n := w^\mathsf{T} v_n\)として，これらの分散を求める．変換前のベクトル\(v_1,\,\ldots,\,v_n\)の平均は
\begin{align*}
    \overline{v} = \frac{1}{n} \sum_{i = 1}^n v^{(i)}
\end{align*}
である．変換後のベクトルの平均\(\overline{u}\)は，これを用いて
\begin{align*}
    \overline{u} = \frac{1}{n} \sum_{i = 1}^n w^\mathsf{T} v^{(i)} = w^\mathsf{T} \overline{v}
\end{align*}
と表せる．変換後のベクトルの標本分散は
\begin{align*}
    \frac{1}{n - 1} \sum_{i = 1}^n \lvert u^{(i)} - \overline{u}\rvert
    &= \frac{1}{n - 1}\sum_{i = 1}^n \lvert w^\mathsf{T} v^{(i)} - w^\mathsf{T} \overline{v} \rvert^2 \\
    &= \frac{1}{n - 1}\sum_{i = 1}^n \lvert w^\mathsf{T} (v^{(i)} - \overline{v}) \rvert^2 \\
    &= \frac{1}{n - 1} \sum_{i = 1}^n w^\mathsf{T} (v^{(i)} - \overline{v})(v^{(i)} - \overline{v})^\mathsf{T} w \\
    &= w^\mathsf{T}
    \begin{pmatrix}
      \displaystyle \frac{1}{n - 1}\sum_{i = 1}^n (v^{(i)}_1 - \overline{v}_1)^2
      & \cdots &
      \displaystyle \frac{1}{n - 1} \sum_{i = 1}^n (v^{(i)}_p - \overline{v}_p)(v^{(i)}_1 - \overline{v}_1)^\mathsf{T} \\
      \vdots & \ddots & \vdots \\
      \displaystyle \frac{1}{n - 1} \sum_{i = 1}^n (v^{(i)}_1 - \overline{v}_1)(v^{(i)}_p - \overline{v}_p)^\mathsf{T}
      & \cdots &
      \displaystyle
      \frac{1}{n - 1} \sum_{i = 1}^n (v^{(i)}_p - \overline{v}_p)^2
    \end{pmatrix} w
\end{align*}
となる．右辺の
\(p\)
次正方行列（標本分散共分散行列と呼ばれるものになっている）を
\(S\)
と置くと，解くべき問題は
\(w\)
に関する
\(w^\mathsf{T} S w\)
の最大化ということになる．</p>
<p>\(w^\mathsf{T} S w\)
は
\(w\)
によっていくらでも大きくなるので\(w\)の大きさを例えば\(1\)に固定し，
\(w\)の最適な方向を探す問題として扱う．
すなわち以下の制約付き最大化問題を解くことに帰着される：
\begin{align}
  \begin{cases}
    \text{maximize}\quad w^\mathsf{T} S w \\
    \text{subject to}\quad \lVert w \rVert = 1.
  \end{cases}
  \label{opt}
\end{align}
これは<strong>Lagrangeの未定乗数法</strong>（<a href="#miyajima">宮島[2]</a>定理3.15）によって解くことができる．
<p>Lagrangeの未定乗数法を使うための準備として，まずは
\(w \mapsto w^\mathsf{T} S w\)
の<strong>(Fréchet)導関数</strong>(<a href="#miyajima">ibid.</a> &#167;3.2)を求める．
\(w\)
が
\(w + h\)
に変化したときの変化は
\begin{align}
    (w + h)^\mathsf{T} S (w + h) - w^\mathsf{T} S w
    = w^\mathsf{T} S h + h^\mathsf{T} S w + h^\mathsf{T} S h
    \label{diff} \\
\end{align}
である．この式の右辺第2項は
\begin{align*}
    h^\mathsf{T} S w
    &= \langle h,\, Sw \rangle \\
    &= \langle Sw,\,h \rangle \\
    &= (Sw)^\mathsf{T} h \\
    &= w^\mathsf{T} S^\mathsf{T} h
\end{align*}
と計算できる．ここで\(\langle u,\, v \rangle\)は標準内積\(u^\mathsf{T} v\)である．これを用いると式(\ref{diff})の第1項と第2項の和は
\begin{align*}
    w^\mathsf{T} S h + h^\mathsf{T} S w = 2 w^\mathsf{T} S w
\end{align*}
となる．ここで
\(S\)
が対称行列なので
\(S + S^\mathsf{T} = 2 S\)
となることを使った．式(\ref{diff})の右辺第3項は<strong>Cauchy&ndash;Schwarzの不等式</strong>（<a href="#miyajima">ibid.</a> &#167;1.1.2）により
\begin{align}
    h^\mathsf{T} S h = \langle h,\,Sh \rangle \leq \lVert h\rVert \lVert Sh \rVert.
    \label{hsh}
\end{align}
と計算できる．上の式の計算を進めるために，行列ノルムの1つである<strong>Frobeniusノルム</strong>（<a href="#yamamoto">山本[3]</a> &#167;4.1）というものを用いる．行列
\(A = (a_{ij}) \in \mathbb{R}^{n \times n}\)
のFrobeniusノルムは
\begin{align*}
{\lVert A \rVert}_\mathrm{F} = \sqrt{\sum_{(i,\,j) \in \{1,\,\ldots,\,n\}^2} {\lvert a_{ij} \rvert}^2}
\end{align*}
と定義される．このノルムには任意の\(x\)に対して\(\lVert A x\rVert \leq {\lVert A \rVert} \lVert x \rVert\)が成り立つという性質がある（<a href="#yamamoto">ibid.</a> &#167;4.2）．したがって式(\ref{hsh})は
\begin{align*}
h^\mathsf{T} S h \leq \lVert h \rVert {\lVert S \rVert}_\mathrm{F} \lVert h \rVert = {\lVert S \rVert}_\mathrm{F} {\lVert h \rVert}^2
\end{align*}
となる．</p>
<p>最終的に式(\ref{diff})から
\begin{gather*}
    (w + h)^\mathsf{T} S (w + h) - w^\mathsf{T} S w - 2 w^\mathsf{T} S h = h^\mathsf{T} S h \\
    \lvert (w + h)^\mathsf{T} S (w + h) - w^\mathsf{T} S w - 2 w^\mathsf{T} S h \rvert \leq {\lVert S \rVert}_\mathrm{F} {\lVert h \rVert}^2
\end{gather*}
がわかり，\(w \mapsto w^\mathsf{T} S w\)の導関数は\(h \mapsto 2w^\mathsf{T} S h\)で与えられることがわかる．</p>
<p>次に\(w \mapsto w^\mathsf{T} w\)の導関数を求める．\(w\)が\(w + h\)に変化するとき
\begin{align*}
    {(w + h)}^\mathsf{T} (w + h) - w^\mathsf{T} w
    &= w^\mathsf{T} h + h^\mathsf{T} w + h^\mathsf{T} h \\
    &= 2 w^\mathsf{T} h + {\lVert h \rVert}^2
\end{align*}
であるから，
\begin{align*}
    \lvert {(w + h)}^\mathsf{T} (w + h) - w^\mathsf{T} w - 2 w^\mathsf{T} h \rvert = {\lVert h \rVert}^2
\end{align*}
となり，\(w \mapsto w^\mathsf{T} w\)の導関数が\(h \mapsto 2w^\mathsf{T} h\)で与えられることがわかる．</p>
<p>最適化問題(\ref{opt})のLagrangianは
\begin{align*}
    \mathcal{L}(w,\,\lambda) = w^\mathsf{T} S w - \lambda (w^\mathsf{T} w - 1)
\end{align*}
であり，上で求めた結果から
\begin{align*}
    D_w \mathcal{L} (w,\,\lambda) = 2 w^\mathsf{T} S - 2 \lambda  w^\mathsf{T}
\end{align*}
となる．\(D_w \mathcal{L} = 0\)，すなわち
\begin{align*}
    Sw = \lambda w
\end{align*}
となることが，
\(w^\mathsf{T} S w\)
が極大となるための必要条件である．そしてこの条件は\(w\)が固有ベクトルであることと同値である．
最大の固有値を\(\lambda_1\)，その固有値に対応する固有ベクトルを\(w_1\)とすると
\begin{align*}
    w_1^\mathsf{T} S w_1
    = w_1^\mathsf{T} (S w_1)
    = w_1^\mathsf{T} (\lambda_1 w_1)
    = \lambda_1
\end{align*}
となる．</p>
<p>実際にこれが最大値であることを確認する．<strong>Weierstraßの最大値定理</strong>（<a href="#miyajima">宮島[2]</a> 定理1.9）により，
\((p - 1)\)
次元球面
\(S^{p - 1} = \{w \in \mathbb{R}^p \mid \lVert w \rVert = 1\}\)
がコンパクト（今は有界かつ閉であることと同値）であることを確認すればよい．
\(f\colon \mathbb{R}^p \to \mathbb{R}\)を\(f(x) = \lVert x \rVert\)
とすると
\(f\)
は連続写像である．
1点集合\(\{1\}\)は閉集合であるから，\(f^{-1} (\{1\}) = S^{p - 1}\)は\(\mathbb{R}^p\)における閉集合である（<a href="matsumoto">松本[4]</a>定理5.2）．
有界であることは明らかである．
よって
\((p - 1)\)
次元球面はコンパクトであり，
\(w^\mathsf{T} S w\)の最大値が\(\lambda_1\)
であることが確かめられた．</p>
<p>行列\((n - 1)S\)は<strong>Gram行列</strong>（<a href="#yamamoto">山本[3]</a> &#167;1.6）である．
したがって半正定値（<a href="#yamamoto">ibid.</a> &#167;定理2.12）であり，任意の\(w \in \mathbb{R}^p\)に対して\(w^\top S w \geq 0\)を満たす．このとき固有値はすべて非負である（<a href="#yamamoto">ibid.</a>定理2.14）．異なる
\(r\) \((&lt; p)\)
個の固有値
\(\lambda_1 &gt; \lambda_2 &gt; \cdots &gt; \lambda_r \geq 0\)
とそれぞれに対応する固有ベクトル
\(w_1,\,\ldots,\,w_r\)
が得られたと仮定する．このとき
\(r\)
次元の
\(n\)
個のベクトル
\begin{align*}
    \begin{pmatrix}
        w_1^\top v^{(1)} \\
        \vdots \\
        w_r^\top v^{(1)}
    \end{pmatrix}
    ,\,\ldots,\,
    \begin{pmatrix}
        w_1^\top v^{(n)} \\
        \vdots \\
        w_r^\top v^{(n)}
    \end{pmatrix}
\end{align*}
は，\(p\)
より少ない次元で
\(v^{(1)},\,\ldots,\,v^{(n)}\)
の情報を表すものになっている．
詳細は<a href="#konishi">小西[5]</a>などを参照．</p>
</section>
<section id="materials">
  <h2>参考文献</h2>
  <ol class="citation">
    <li id="functional-analysis">宮島静雄(2005) 『関数解析』横浜図書．</li>
    <li id="miyajima">宮島静雄(2003) 『微分積分学II』共立出版．</li>
    <li id="yamamoto">山本哲朗(2010) 『行列解析の基礎 Advanced線形代数』サイエンス社．</li>
    <li id="matsumoto">松本幸夫(1985) 『トポロジー入門』岩波書店．</li>
    <li id="konishi">小西貞則(2021) 『多変量解析入門&mdash;線形から非線形へ&mdash;〔電子書籍版〕』岩波書店．</li>
  </ol>
</section>

  </div>
</article>

      </main>
      <footer>
        <div class="footer text-center">
  <span>© 2015&ndash;2023 Akira Miyazawa</span>
</div>

      </footer>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap.native@2.0.15/dist/bootstrap-native-v4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-SkmBfuA2hqjzEVpmnMt/LINrjop3GKWqsuLSSB3e7iBmYK7JuWw4ldmmxwD9mdm2IRTTi0OxSAfEGvgEi0i2Kw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://kit.fontawesome.com/30a99ec99f.js" crossorigin="anonymous"></script>
<script src="/static/js/findAndReplaceDOMText.js"></script>
<script src="/static/js/main.js"></script>

      
        <script src="/static/js/mathjax.js"></script>
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js?config=TeX-AMS_HTML"></script>
        </script>
      
    </div>
  </body>
</html>
